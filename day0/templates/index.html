<!DOCTYPE html> <!-- HTML5 문서임을 선언 -->
<html>
<head>
  <title>간단 게시판</title> <!-- 브라우저 탭에 표시될 제목 -->
  <style>
    /* 전체 body에 폰트와 마진 적용 */
    body { font-family: Arial, sans-serif; margin: 40px; }
    /* 게시글 작성 폼은 기본적으로 숨김, 아래쪽 여백 추가 */
    #postForm { display: none; margin-bottom: 20px; }
    /* 게시글 목록 아래쪽 여백 */
    #posts { margin-bottom: 30px; }
    /* 각 게시글 구분선과 위아래 패딩 */
    .post { border-bottom: 1px solid #ddd; padding: 10px 0; }
    /* 게시글 제목은 굵게 표시 */
    .post-title { font-weight: bold; }
    /* 게시글 내용은 제목보다 약간 들여쓰고, 색상 연하게 */
    .post-content { margin: 5px 0 0 10px; color: #555; }
    /* 버튼 위쪽에 여백 */
    button { margin-top: 10px; }
  </style>
</head>
<body>
  <h1>간단 게시판</h1> <!-- 페이지 상단 제목 -->

  <!-- 게시글 목록이 표시될 영역 -->
  <div id="posts">
    <!-- 게시글 목록이 여기에 표시됩니다 -->
  </div>

  <!-- 게시글 작성 폼을 띄우는 버튼 -->
  <button id="showFormBtn" onclick="showForm()">게시글 작성</button>

  <!-- 게시글 작성 폼 (기본적으로 숨겨짐) -->
  <div id="postForm">
    <h2>게시글 작성</h2>
    <!-- 제목 입력란 -->
    <input type="text" id="title" placeholder="제목"><br>
    <!-- 내용 입력란 -->
    <textarea id="content" placeholder="내용"></textarea><br>
    <!-- 저장 버튼: 게시글 저장 함수 호출 -->
    <button onclick="savePost()">저장하기</button>
    <!-- 취소 버튼: 폼 숨기기 함수 호출 -->
    <button onclick="hideForm()">취소</button>
  </div>

  <script>
    // 게시글 목록을 서버에서 불러와서 화면에 표시하는 함수
    function loadPosts() {
      fetch("/posts") // /posts 엔드포인트로 GET 요청
        .then(res => res.json()) // 응답을 JSON으로 변환
        .then(data => {
          const postsDiv = document.getElementById("posts"); // 게시글 목록 영역 선택
          postsDiv.innerHTML = ""; // 기존 목록 초기화
          if (data.length === 0) { // 게시글이 없으면 안내 문구 표시
            postsDiv.innerHTML = "<p>게시글이 없습니다.</p>";
            return;
          }
          // 게시글이 있으면 각각 화면에 추가
          data.forEach(post => {
            const postEl = document.createElement("div"); // 게시글 div 생성
            postEl.className = "post"; // 스타일 적용을 위한 클래스 지정
            postEl.innerHTML = `
              <div class="post-title">${post.title}</div> <!-- 제목 표시 -->
              <div class="post-content">${post.content}</div> <!-- 내용 표시 -->
            `;
            postsDiv.appendChild(postEl); // 게시글 목록에 추가
          });
        });
    }

    // 게시글 작성 폼을 보여주는 함수
    function showForm() {
      document.getElementById("postForm").style.display = "block"; // 폼 보이기
      document.getElementById("showFormBtn").style.display = "none"; // 작성 버튼 숨기기
    }

    // 게시글 작성 폼을 숨기는 함수
    function hideForm() {
      document.getElementById("postForm").style.display = "none"; // 폼 숨기기
      document.getElementById("showFormBtn").style.display = "inline"; // 작성 버튼 다시 보이기
      document.getElementById("title").value = ""; // 제목 입력란 초기화
      document.getElementById("content").value = ""; // 내용 입력란 초기화
    }

    // 게시글을 서버에 저장하는 함수
    function savePost() {
      const title = document.getElementById("title").value; // 제목 값 가져오기
      const content = document.getElementById("content").value; // 내용 값 가져오기

      fetch("/save", { // /save 엔드포인트로 POST 요청
        method: "POST",
        headers: { "Content-Type": "application/json" }, // JSON 형식 명시
        body: JSON.stringify({ title, content }) // 데이터 전송
      })
      .then(response => response.json()) // 응답을 JSON으로 변환
      .then(data => {
        alert("저장 완료: " + data["message"]); // 저장 완료 알림
        hideForm(); // 폼 숨기기
        loadPosts(); // 게시글 목록 새로고침
      });
    }

    // 페이지가 로드될 때 게시글 목록을 불러옴
    window.onload = loadPosts;
  </script>
</body>
</html>
